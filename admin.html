<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - RoK DKP Tracker</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body class="admin-body">
    <div id="adminApp">
        <header class="admin-header">
            <div class="header-content">
                <h1>üè∞ KvK DKP Tracker - ADMIN MODE</h1>
                <div class="admin-controls">
                    <span class="admin-status">Admin: Active</span>
                    <button id="logoutBtn" class="logout-btn">Logout</button>
                </div>
            </div>
        </header>

        <nav class="admin-nav">
            <button class="nav-btn active" data-view="map">üó∫Ô∏è Upload Data</button>
            <button class="nav-btn" data-view="rankings">üìä View Rankings</button>
            <button class="nav-btn" data-view="analytics">üìà Analytics</button>
            <button class="nav-btn" data-view="manage">‚öôÔ∏è Manage</button>
        </nav>

        <main class="admin-content">
            <div id="mapView" class="view-panel active">
                <h2>Interactive Map - Click KD to Upload</h2>
                <div class="map-instructions">
                    <p>‚Ä¢ Click any KD number on the map to upload CSV data</p>
                    <p>‚Ä¢ Green = Data uploaded | Red = Missing data | Yellow = Partial data</p>
                </div>
                
                <div class="map-container">
                    <img src="assets/KvKMap.png" alt="KvK Map" usemap="#kdMap" class="interactive-map">
                    <map name="kdMap" id="kdMap">
                        <!-- Fire Camp KDs -->
                        <area shape="rect" coords="139,194,180,220" data-kd="1400" data-camp="Fire" href="#" alt="KD 1400">
                        <area shape="rect" coords="190,194,230,220" data-kd="1068" data-camp="Fire" href="#" alt="KD 1068">
                        <area shape="rect" coords="240,194,280,220" data-kd="1471" data-camp="Fire" href="#" alt="KD 1471">
                        <area shape="rect" coords="290,194,330,220" data-kd="2162" data-camp="Fire" href="#" alt="KD 2162">
                        <area shape="rect" coords="340,194,380,220" data-kd="2197" data-camp="Fire" href="#" alt="KD 2197">
                        <area shape="rect" coords="139,230,180,260" data-kd="1520" data-camp="Fire" href="#" alt="KD 1520">
                        
                        <!-- Earth Camp KDs -->
                        <area shape="rect" coords="840,200,880,230" data-kd="1244" data-camp="Earth" href="#" alt="KD 1244">
                        <area shape="rect" coords="890,200,930,230" data-kd="1694" data-camp="Earth" href="#" alt="KD 1694">
                        <area shape="rect" coords="940,200,980,230" data-kd="2944" data-camp="Earth" href="#" alt="KD 2944">
                        <area shape="rect" coords="990,200,1030,230" data-kd="3590" data-camp="Earth" href="#" alt="KD 3590">
                        <area shape="rect" coords="840,240,880,270" data-kd="2546" data-camp="Earth" href="#" alt="KD 2546">
                        <area shape="rect" coords="890,240,930,270" data-kd="1014" data-camp="Earth" href="#" alt="KD 1014">
                        
                        <!-- Water Camp KDs -->
                        <area shape="rect" coords="121,689,161,719" data-kd="3554" data-camp="Water" href="#" alt="KD 3554">
                        <area shape="rect" coords="171,689,211,719" data-kd="1896" data-camp="Water" href="#" alt="KD 1896">
                        <area shape="rect" coords="221,689,261,719" data-kd="1569" data-camp="Water" href="#" alt="KD 1569">
                        <area shape="rect" coords="271,689,311,719" data-kd="3152" data-camp="Water" href="#" alt="KD 3152">
                        <area shape="rect" coords="321,689,361,719" data-kd="3596" data-camp="Water" href="#" alt="KD 3596">
                        <area shape="rect" coords="121,729,161,759" data-kd="2711" data-camp="Water" href="#" alt="KD 2711">
                        <area shape="rect" coords="171,729,211,759" data-kd="1267" data-camp="Water" href="#" alt="KD 1267">
                        
                        <!-- Wind Camp KDs -->
                        <area shape="rect" coords="824,667,864,697" data-kd="2352" data-camp="Wind" href="#" alt="KD 2352">
                        <area shape="rect" coords="874,667,914,697" data-kd="2973" data-camp="Wind" href="#" alt="KD 2973">
                        <area shape="rect" coords="924,667,964,697" data-kd="1477" data-camp="Wind" href="#" alt="KD 1477">
                        <area shape="rect" coords="974,667,1014,697" data-kd="1294" data-camp="Wind" href="#" alt="KD 1294">
                        <area shape="rect" coords="1024,667,1064,697" data-kd="1732" data-camp="Wind" href="#" alt="KD 1732">
                        <area shape="rect" coords="824,707,864,737" data-kd="2509" data-camp="Wind" href="#" alt="KD 2509">
                        <area shape="rect" coords="874,707,914,737" data-kd="1359" data-camp="Wind" href="#" alt="KD 1359">
                    </map>
                    
                    <!-- KD Labels Overlay -->
                    <div class="kd-labels">
                        <!-- Fire KDs -->
                        <div class="kd-label fire" style="left: 139px; top: 194px;" data-kd="1400">1400</div>
                        <div class="kd-label fire" style="left: 190px; top: 194px;" data-kd="1068">1068</div>
                        <div class="kd-label fire" style="left: 240px; top: 194px;" data-kd="1471">1471</div>
                        <div class="kd-label fire" style="left: 290px; top: 194px;" data-kd="2162">2162</div>
                        <div class="kd-label fire" style="left: 340px; top: 194px;" data-kd="2197">2197</div>
                        <div class="kd-label fire" style="left: 139px; top: 230px;" data-kd="1520">1520</div>
                        
                        <!-- Earth KDs -->
                        <div class="kd-label earth" style="left: 840px; top: 200px;" data-kd="1244">1244</div>
                        <div class="kd-label earth" style="left: 890px; top: 200px;" data-kd="1694">1694</div>
                        <div class="kd-label earth" style="left: 940px; top: 200px;" data-kd="2944">2944</div>
                        <div class="kd-label earth" style="left: 990px; top: 200px;" data-kd="3590">3590</div>
                        <div class="kd-label earth" style="left: 840px; top: 240px;" data-kd="2546">2546</div>
                        <div class="kd-label earth" style="left: 890px; top: 240px;" data-kd="1014">1014</div>
                        
                        <!-- Water KDs -->
                        <div class="kd-label water" style="left: 121px; top: 689px;" data-kd="3554">3554</div>
                        <div class="kd-label water" style="left: 171px; top: 689px;" data-kd="1896">1896</div>
                        <div class="kd-label water" style="left: 221px; top: 689px;" data-kd="1569">1569</div>
                        <div class="kd-label water" style="left: 271px; top: 689px;" data-kd="3152">3152</div>
                        <div class="kd-label water" style="left: 321px; top: 689px;" data-kd="3596">3596</div>
                        <div class="kd-label water" style="left: 121px; top: 729px;" data-kd="2711">2711</div>
                        <div class="kd-label water" style="left: 171px; top: 729px;" data-kd="1267">1267</div>
                        
                        <!-- Wind KDs -->
                        <div class="kd-label wind" style="left: 824px; top: 667px;" data-kd="2352">2352</div>
                        <div class="kd-label wind" style="left: 874px; top: 667px;" data-kd="2973">2973</div>
                        <div class="kd-label wind" style="left: 924px; top: 667px;" data-kd="1477">1477</div>
                        <div class="kd-label wind" style="left: 974px; top: 667px;" data-kd="1294">1294</div>
                        <div class="kd-label wind" style="left: 1024px; top: 667px;" data-kd="1732">1732</div>
                        <div class="kd-label wind" style="left: 824px; top: 707px;" data-kd="2509">2509</div>
                        <div class="kd-label wind" style="left: 874px; top: 707px;" data-kd="1359">1359</div>
                    </div>
                </div>
            </div>

            <div id="rankingsView" class="view-panel">
                <h2>Kingdom Rankings</h2>
                <div class="rankings-controls">
                    <select id="rankingsEventFilter" class="form-select" style="width: auto; display: inline-block;">
                        <option value="cumulative">All Events (Cumulative)</option>
                        <option value="Pass 4*">Pass 4*</option>
                        <option value="Altar of darkness">Altar of darkness</option>
                        <option value="Pass 7">Pass 7</option>
                        <option value="Pass 8">Pass 8</option>
                        <option value="Great ziggurat">Great ziggurat</option>
                    </select>
                    <button id="refreshRankings" class="btn-secondary" style="margin-left: 10px;">Refresh</button>
                </div>
                <div class="table-container" style="margin-top: 20px;">
                    <table class="data-table" id="rankingsTable">
                        <thead>
                            <tr>
                                <th>Rank</th>
                                <th>Kingdom</th>
                                <th>Camp</th>
                                <th>Total DKP</th>
                                <th>Kill Points</th>
                                <th>T5 Kills</th>
                                <th>T4 Kills</th>
                                <th>Deaths</th>
                                <th>Healed</th>
                                <th>Players</th>
                            </tr>
                        </thead>
                        <tbody id="rankingsTableBody">
                            <!-- Rankings will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <div id="analyticsView" class="view-panel">
                <h2>Analytics Dashboard</h2>
                <div class="analytics-grid">
                    <div class="analytics-card">
                        <h3>Upload Status</h3>
                        <canvas id="uploadStatusChart"></canvas>
                    </div>
                    <div class="analytics-card">
                        <h3>DKP Trends</h3>
                        <canvas id="dkpTrendsChart"></canvas>
                    </div>
                </div>
            </div>

            <div id="manageView" class="view-panel">
                <h2>Data Management</h2>
                <div class="manage-actions">
                    <button class="btn-secondary">Clear Event Data</button>
                    <button class="btn-danger">Reset Database</button>
                </div>
                <div class="manage-info">
                    <p><strong>Clear Event Data:</strong> Removes all uploaded event data and player statistics while keeping kingdom structure.</p>
                    <p><strong>Reset Database:</strong> Completely wipes all data including kingdoms, events, and aggregates. Use with extreme caution!</p>
                </div>
            </div>
        </main>
    </div>

    <!-- Upload Modal -->
    <div id="uploadModal" class="modal">
        <div class="modal-content upload-modal">
            <span class="close">&times;</span>
            <h2>üìä Upload Stats for KD <span id="uploadKD"></span></h2>
            
            <div class="upload-form">
                <div class="form-group">
                    <label>Select Event:</label>
                    <select id="eventSelect" class="form-select">
                        <option value="">-- Select Event --</option>
                        <option value="Pass 4*">Pass 4* - Thu, 11.9, 7:04</option>
                        <option value="Altar of darkness">Altar of darkness - Tue, 23.9, 7:04</option>
                        <option value="Pass 7">Pass 7 - Fri, 3.10, 7:04</option>
                        <option value="Pass 8">Pass 8 - Mon, 6.10, 7:04</option>
                        <option value="Great ziggurat">Great ziggurat - Sun, 12.10, 7:04</option>
                    </select>
                </div>

                <div class="upload-zone-single">
                    <h3>Event Score Data</h3>
                    <p class="upload-instructions">Upload the Excel/CSV file containing the event scores (deltas already calculated)</p>
                    <div class="drop-area" id="eventDrop">
                        <p>üìÅ Drop Excel/CSV here or click to browse</p>
                        <input type="file" id="eventFile" accept=".xlsx,.xls,.csv" hidden>
                    </div>
                    <div class="upload-status" id="eventStatus"></div>
                </div>

                <div class="dkp-preview" id="dkpPreview" style="display: none;">
                    <h3>DKP Calculation Preview:</h3>
                    <div class="calculation-details">
                        <div>‚Ä¢ T5 Kills: <span id="t5Preview">0</span> √ó 10 = <span id="t5Points">0</span></div>
                        <div>‚Ä¢ T4 Kills: <span id="t4Preview">0</span> √ó 5 = <span id="t4Points">0</span></div>
                        <div>‚Ä¢ Deaths: <span id="deathsPreview">0</span> √ó 15 = <span id="deathPoints">0</span></div>
                        <div class="total-dkp">‚Ä¢ Total DKP: <span id="totalDKP">0</span></div>
                    </div>
                </div>

                <div class="modal-buttons">
                    <button type="button" id="calculateBtn" class="btn-primary" disabled>üìä Calculate & Save</button>
                    <button type="button" id="cancelUpload" class="btn-secondary">‚ùå Cancel</button>
                </div>
                <div class="upload-hint" id="uploadHint" style="text-align: center; margin-top: 10px; color: #666; font-size: 0.9em;">
                    ‚ÑπÔ∏è Select an event and upload a file to enable the save button
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>
    
    <!-- SheetJS for Excel file parsing -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    
    <!-- PapaParse for CSV (kept for backwards compatibility) -->
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Application Scripts -->
    <script src="js/firebase-config.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/map-handler.js"></script>
    <script src="js/file-parser.js"></script>
    <script src="js/data-processor.js"></script>
    <script src="js/data-retriever.js"></script>
    <script src="js/admin.js"></script>
</body>
</html>
